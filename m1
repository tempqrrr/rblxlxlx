print("M1 loop initialized")

local remoteEvent = game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main"):WaitForChild("dataRemoteEvent")

local function getBossHRP()
    local Players = game:GetService("Players")
    local entities = workspace:FindFirstChild("Entities")
    if not entities then return nil end

    for _, entity in ipairs(entities:GetChildren()) do
        if not Players:GetPlayerFromCharacter(entity) then
            local hrp = entity:FindFirstChild("HumanoidRootPart")
            if hrp then return hrp end
        end
    end
    return nil
end

local bossExists = false

local function checkBossLoop()
    while true do
        bossExists = getBossHRP() ~= nil
        task.wait(3) -- Check every 3 seconds
    end
end

local toggled = true

local args = {
    [1] = {
        [1] = {
            ["Module"] = "M1"
        },
        [2] = "\5"
    }
}

local function keepM1ing()
    while true do
        if bossExists and toggled then
            remoteEvent:FireServer(unpack(args))
            task.wait(0.1)
        else
            task.wait(0.3)
        end
    end
end

task.spawn(checkBossLoop)
task.spawn(keepM1ing)
