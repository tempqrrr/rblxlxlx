print("Facer module initialized")

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = game:GetService("Workspace").CurrentCamera

local humanoid = nil
local maxHealth = nil
local isCamLocking = false
local isFacingBoss = false
local camLockConnection
local faceBossConnection

-- Function to find the Boss's HumanoidRootPart
local function getBossHRP()
    local entities = workspace:FindFirstChild("Entities")
    if not entities then return nil end

    for _, entity in ipairs(entities:GetChildren()) do
        if not Players:GetPlayerFromCharacter(entity) then
            local hrp = entity:FindFirstChild("HumanoidRootPart")
            if hrp then
                return hrp
            end
        end
    end
    return nil
end

-- Function to lock the camera onto the boss (X & Z axes only)
local function camLockOntoBoss()
    if isCamLocking then return end
    isCamLocking = true

    camLockConnection = RunService.RenderStepped:Connect(function()
        local bossHRP = getBossHRP()
        if not bossHRP then
            isCamLocking = false
            camLockConnection:Disconnect()
            return
        end

        local camPos = Camera.CFrame.Position
        local bossPos = bossHRP.Position
        local targetPos = Vector3.new(bossPos.X, camPos.Y, bossPos.Z)
        Camera.CFrame = CFrame.lookAt(camPos, targetPos)
    end)
end

-- Function to make the player face the boss (X & Z axes only)
local function faceBoss()
    if isFacingBoss then return end
    isFacingBoss = true

    faceBossConnection = RunService.RenderStepped:Connect(function()
        local bossHRP = getBossHRP()
        local character = player.Character
        if not bossHRP or not character then
            isFacingBoss = false
            faceBossConnection:Disconnect()
            return
        end

        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local playerPos = hrp.Position
            local bossPos = bossHRP.Position
            local targetPos = Vector3.new(bossPos.X, playerPos.Y, bossPos.Z)
            hrp.CFrame = CFrame.lookAt(playerPos, targetPos)
        end
    end)
end

-- Function to start cam lock on respawn
local function startCamLockOnRespawn()
    player.CharacterAdded:Connect(function(character)
        humanoid = character:WaitForChild("Humanoid")
        maxHealth = humanoid.Health
        task.spawn(camLockOntoBoss)
        task.spawn(faceBoss)
    end)
end

-- Start cam lock and facing when boss exists
task.spawn(camLockOntoBoss)
task.spawn(faceBoss)
startCamLockOnRespawn()
